<project>
  <target name="jar:setup" depends="setup" description="Prepare for Java Archive">
		<property name="vendor.name"   value="Magnus Falk"/>
		<property name="keystore.file" location="${buildSupport}\codeSigningKeystore"/> 
	  <property name="jarfile" 			 value="${deploymentDir}/${prod.name}.jar"/>
  	<property name="jnlpfile" 		 value="${resourceDir}/${prod.name}.jnlp"/>

    <property name="keystore.alias"     value="mykey"/>
    <property name="keystore.storepass" value="darkl00ba"/>
    <property name="keystore.keypass"   value="${keystore.storepass}"/>

    <path id="project.src.path">
      <pathelement path="${sourceDir}"/>
    </path>
  </target>

  <target name="jar:clean" description="Removes temporary Java files">
    <delete dir="${outputDir}" />
  </target>

  <!-- Override this target to do project specific preparations -->
  <target name="jar:depends" />

  <target name="jar:compile" depends="jar:setup, jar:depends" 
          description="Compiles the java files">
    <javac deprecation="${deprecation}" destdir="${outputDir}" debug="on" 
           encoding="ISO-8859-1">
      <src       refid="project.src.path"/>
      <classpath refid="jar.class.path"/>
    </javac>
  </target>


  <target name="jar" depends="jar:compile" 
          description="Package into a JAVA Archive">
    <mkdir dir="${deploymentDir}"/>
    
    <manifest file="${outputDir}/manifest.mf">
      <attribute name="Specification-Title" value="${prod.name}"/>
      <attribute name="Specification-Vendor" value="${vendor.name}"/>
      <attribute name="Specification-Version" value="${prod.version}"/>
      <attribute name="Implementation-Title" value="${prod.name}"/>
      <attribute name="Implementation-Vendor" value="${vendor.name}"/>
      <attribute name="Implementation-Version" value="${prod.revision}"/> 
    </manifest>

    <copy todir="${outputDir}">
      <fileset dir="resources/jar">
        <filename name="*.*"/>
      </fileset> 
    </copy> 
   
    <jar jarfile="${jarfile}" 
         basedir="${outputDir}" 
         manifest="${outputDir}/manifest.mf"/>
  </target>

  <target name="jar:sign" depends="jar">    
    <signjar jar="${jarfile}" 
             alias="${keystore.alias}"   storepass="${keystore.storepass}"
             keystore="${keystore.file}" keypass="${keystore.keypass}" />
	</target>

	<target name="jar:deploy" depends="jar:sign" 
          description="Creates a Webstart application and deploys it">
    <property name="private.key"     location="../../DSA_MagnusFalk.ppk"/> 
    <property name="private.keypass" value="${keystore.storepass}"/>    
    
    <property name="server" value="www.team286.org"/> 
    <property name="server.username" value="fylke"/> 
    <property name="server.password" value="8Cogling0"/>
        
    <scp file="${jnlpfile}"
         todir="${server.username}:${server.password}@${server}:/home/fylke/public_html"
         trust="true"> 
    </scp>
   
    <scp todir="${server.username}:${server.password}@${server}:/home/fylke/public_html/TimeTool"
         trust="true"> 
      <fileset dir="${deploymentDir}">
        <include name="*.*"/>
      </fileset>
    </scp>       
  </target>
</project>
